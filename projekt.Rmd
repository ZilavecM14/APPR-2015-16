---
title: "Poročilo pri predmetu Analiza podatkov s programom R-Analiza štipendiranja v Sloveniji"
author: "Mojca Žilavec"
output:
  pdf_document:
    latex_engine: xelatex
    includes:
      in_header: lib/styles.sty
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Izbrala sem si temo analiza stipendiranja v Sloveniji. Podatke sem dobila z Statističnega urada Slovenije, Kariernih centrov v Ljubljani. Moj cilj je opredeliti, katerih štipendij je v Sloveniji največ, jih regijsko razdeliti ter pokazati, ali imajo več štipendij dijaki, študentje, neznano. Osredotočila se bom tudi na leto 2014 in ugotovila, kako so bile podeljenje štipendije v tem letu.  

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE,message=FALSE, warning=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozila sem podatke o štipendijah v obliki CSV s statističnega urada ter v obliki HTML z prav tako s statističnega urada republike Slovenije. 

Prva uvožena razpredelnica je v obliki HTML s spletne strani (http://pxweb.stat.si/pxweb/Dialog/viewplus.asp?ma=H111S&ti=&path=../Database/Hitre_Repozitorij/&lang=2). Ker me zanimajo podatki o štipendijah po vrstah in izobrazbi, sem uvoženo tabelo s spletne strani razdelila na več manjših podtabel. Nato sem iz vsake podatabele izluščila leto 2014. 


```{r}
#spletni naslov na katerem se nahaja tabela (SURS)
url <- "http://pxweb.stat.si/pxweb/Dialog/viewplus.asp?ma=H111S&ti=&path=../Database/Hitre_Repozitorij/&lang=2"


#kodna tabela
stran <- html_session(url) %>% read_html(encoding="UTF-8")
tabela <- stran %>% html_node(xpath = "//table[@class='pxtable']") %>% html_table()
Encoding(tabela[[1]]) <- "UTF-8"
names(tabela) <- tabela[1,]
names(tabela)[1] <- "vrsta" #Poimenovan drugi stolpec tabele
tabela <- tabela[-c(1, nrow(tabela)),] 
tabela <- data.frame(kategorija = tabela[,1], tabela)

kategorije <- factor(tabela$kategorija[seq(1,nrow(tabela),10)])
tabela$kategorija <- as.vector(t(matrix(rep(kategorije, 10), nrow=4)))
tabela <- tabela[-seq(1, nrow(tabela), 10),]

```

Ker me zanimajo podatki o štipendijah po vrstah in izobrazbi, sem uvoženo tabelo s spletne strani razdelila na več manjših podtabel. Nato sem iz vsake podatabele izluščila leto 2014. Podatke sem prečistilna na naslednji način. 

```{r}
#locimo od velike tabele, na vec manjsih tabel
#skupaj
skupaj <- filter(tabela, kategorija == kategorije[1]) #izberemo po prvi kategoriji
skupaj14 <- select(skupaj, vrsta, X2014) #ločimo na leto 2014
skupaj141 <- skupaj[1:9,9] #izberemo podeljene štipendije v letu 2014 v obliki vektorja

#dijaki
dijaki <- filter (tabela, kategorija == kategorije[2])
dijaki14 <- select(dijaki, vrsta, X2014)
dijaki141 <- dijaki[1:9,9]

#studenti
studenti <- filter (tabela, kategorija == kategorije[3])
studenti14<-select(studenti, vrsta, X2014)
studenti141 <- studenti[1:9,9]

#neznano
neznano <- filter (tabela, kategorija == kategorija [4])
neznano14 <-select(neznano, vrsta, X2014)
neznano141 <- neznano[1:9,9]

```


Drugo tabelo sem uvozila v obliki csv. Razpredelnico sem naložila s podatki o številu štipendij v različnih regijah v Soveniji, ločene na spol in leta. 


```{r}
#http://pxweb.stat.si/pxweb/Dialog/Saveshow.asp
#Funkcija, ki uvozi podatke iz datoteke stipendije.csv
uvozi.stipendije <-function() {
  return(read.csv2("podatki/stipendije.csv", sep=";", as.is=TRUE,
                    na.strings = "-", header = FALSE,
                    fileEncoding = "Windows-1250",
         col.names = c("regija", "kategorija", "vrsta",
                       as.vector(outer(c("skupaj", "moski", "zenske", "neznano"),
                                       2008:2014, paste0)))))
}

#Zapisemo podatke v razpredelnico stipendije
stipendije <- uvozi.stipendije ()

```

Na podlagi prve tabele sem naredila dva grafa. Prvi graf prikazuje razporeditev državne štipendije, glede na vse ostale štipendije. Prvi stolpec prikazuje državne štipendije, drugi pa vse ostale. Dijaki, neznano in štipendije so vsake obravnane v svoje barve. 

```{r graf,echo=FALSE, FIG.CAP="Graf državne štipendije in ostale štipendije"}
ggplot(data=tabela %>% filter(kategorija != kategorija[1], vrsta != vrsta[1]),
       aes(x=drzavna,y=X2014,fill=kategorija))+geom_bar(stat = "identity") 

```

Drugi graf praikzuje razporeditev vseh štipendij, razen državnih. Ponovno so dijaki, študentje in neznano razporejeni v svoje kategorije. 

```{r graf1,echo=FALSE, FIG.CAP="Graf vse štipendije"}
ggplot(data=tabela %>% filter(kategorija != kategorija[1], ! vrsta %in% vrsta[c(1,6)]),
       aes(x=vrsta,y=X2014,fill=kategorija))+geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) 

```

***


# Analiza in vizualizacija podatkov


Slika \ref{fig:graf} prikazuje 
